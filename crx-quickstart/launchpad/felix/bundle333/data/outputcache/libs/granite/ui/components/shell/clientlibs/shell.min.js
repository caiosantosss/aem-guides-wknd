(function(f,e,h){function d(b,c,g){b={element:h(b).is("coral-shell-header-home")?"logo":" close",feature:"globalnav",type:"toggleable",action:g,widget:{name:"globalnav",type:"toggleable"},attributes:{}};h(f).adaptTo("foundation-tracker").trackEvent(b)}h(e).on("click",".globalnav-toggle",function(b){b.preventDefault();var c=e.getElementById("globalnav-overlay");if(c)d(this,b,"hide"),c.hide();else{d(this,b,"show");b=e.getElementsByClassName("globalnav-navigator-backbutton");c=f.location.pathname;if(b&&
b.length&&b[0].hidden&&c.includes("/aem/start")&&(b=e.getElementById("globalnav-start-home-collection"))&&(b=b.closest("coral-panel"))&&b.selected)return;var g=h(f).adaptTo("foundation-ui");g.wait();h.ajax({url:this.dataset.globalnavToggleHref,cache:!1,success:function(u){var q=h(u).get(0),y=h(q);h("coral-shell").append(q);h("#globalNavHeader").attr("aria-expanded",!0);y.trigger("foundation-contentloaded");y.on("coral-overlay:close",function(l){l.target===q&&(y.remove(),h("#globalNavHeader").attr("aria-expanded",
!1))});Coral.commons.ready(q,function(){g.clearWait();q.open=!0;var l=y.find(".globalnav-activeconsole").first();l.length&&(l.is(".foundation-collection-navigator.globalnav-homecard")?l.trigger("click"):l.is(".globalnav-tools-navigation-item")&&l.prop("active",!0),setTimeout(function(){l.closest("coral-panel").attr("selected","")},0))})}})}});h(e).on("click",".globalnav-anchor",function(b){var c=h(this);if(b=c.data("globalnav-anchor-href"))c=c.data("globalnav-anchor-target")||"_self","single"===(h(f).adaptTo("foundation-preference").get("winMode")||
"multi")&&(c="_self"),"null"!==(new URL(b,e.baseURI)).origin&&f.open(b,c)});h(e).on("foundation-collection-navigate",".foundation-collection",function(b){var c=h(this);h(".granite-collection-navigator.globalnav-navigator").each(function(){if(c.is(this.dataset.graniteCollectionNavigatorTarget)){var g=h(this).prev(".globalnav-navigator-backbutton");g[0].label.textContent=this.selectedItem.textContent;h(this.selectedItem).next("betty-breadcrumbs-item").length?g.removeAttr("hidden"):g.attr("hidden","")}})});
h(e).on("click",".globalnav-navigator-backbutton",function(b){b=h(this).next("betty-breadcrumbs.globalnav-navigator");h(b.prop("selectedItem")).next("betty-breadcrumbs-item").prop("selected",!0);var c=e.createEvent("HTMLEvents");c.initEvent("change",!0,!1);b[0].dispatchEvent(c)});h(e).on("coral-columnview:activeitemchange",".globalnav-tools-navigation",function(b){b=b.originalEvent.detail.activeItem;h(this).find(".foundation-selections-item").removeClass("foundation-selections-item");b.classList.add("foundation-selections-item");
h(this).trigger("foundation-selections-change")});h(e).on("coral-collection:add","#globalnav-start-home-collection,#globalnav-home-collection,#globalnav-start-tools-content-collection,#globalnav-tools-content-collection",function(b){var c=b.originalEvent.detail.item;Coral.commons.nextFrame(function(){c.removeAttribute("aria-selected")})});h(e).on("keydown","#globalnav-start-home-collection .foundation-collection-item,#globalnav-home-collection .foundation-collection-item,#globalnav-start-tools-content-collection .foundation-collection-item,#globalnav-tools-content-collection .foundation-collection-item",
function(b){if(32===b.keyCode){b.preventDefault();var c=b.target;c.selected=!1;Coral.commons.nextFrame(function(){c.removeAttribute("aria-selected");c.tabIndex=-1})}});h(e).on("focus","coral-masonry-item.foundation-collection-item",function(b){var c=b.target;c.contains(b.relatedTarget)||(h(c).find(".globalnav-homecard, .globalnav-toolcard").focus(),Coral.commons.nextFrame(function(){c!==e.activeElement&&(c.tabIndex=-1)}))});h(e).on("keydown",".globalnav-homecard, .globalnav-toolcard",function(b){switch(b.keyCode){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 72:case 74:case 75:case 76:var c=
h(b.target).closest("coral-masonry-item.foundation-collection-item"),g=e.createEvent("Event");g.initEvent("keydown",!0,!0);g.key=b.key;g.keyCode=b.keyCode;g.which=b.which;g.key=b.key;g.shiftKey=b.shiftKey;g.ctrlKey=b.ctrlKey;g.metaKey=b.metaKey;c[0].dispatchEvent(g);break;case 13:case 32:b.preventDefault(),b.target.click()}})})(window,document,Granite.$);
(function(f,e){function h(l,H,r,v){return l.find(function(x){if(r&&v){if(!x.name.startsWith(H+"."))return!1;x=x.name.substring((H+".").length);return y.exec(x)[2]===r}return x.name===H+(r?"."+r:"")})}function d(){var l=e(".granite-omnisearch-predicates");e(".granite-omnisearch-facet-count",l).remove();e(".granite-omnisearch-facet-labelcount",l).remove()}function b(l,H){var r=e(".granite-omnisearch-predicates coral-accordion-item-content"),v=e();v=v.add(r.find("coral-checkbox").not("coral-accordion-item-label *"));
v=v.add(r.find("coral-radio").not("coral-accordion-item-label *"));var x=e();l.forEach(function(A){a:switch(y.exec(A.predicate.split(".").pop())[2]){case "property":case "boolproperty":var L=q.property;break a;default:L=q["default"]}var I=v.filter("[name^\x3d'"+A.predicate+"']");I.each(function(D,R){D=e(R);D=D.add(D.closest("coral-accordion-item-content").children("input[name^\x3d'"+A.predicate+"']")).add(D.siblings("input[name^\x3d'"+A.predicate+"']")).toArray().map(function(z){return{name:z.name,
value:z.value}});D=L.getCount(A,D);null!==D&&((0<D.count||H.showAggregateCount)&&c(R,D.count,"granite-omnisearch-facet-count"),u.set(R,D))});x=x.add(I)});return x}function c(l,H,r){e(document.createElement("span")).addClass(r).text(" ("+H+")").appendTo(l.label)}function g(l,H){var r=l.toArray();H.showAggregateCount?e(".granite-omnisearch-predicates coral-accordion-item-label coral-checkbox").each(function(v,x){var A=e(x).closest("coral-accordion-item");v=r.filter(function(I){return 0<A.has(I).length});
if(v.length){var L=new Map;v=v.reduce(function(I,D){D=u.get(D);var R=0;null===D.key||L.has(D.key)||(L.set(D.key,!0),R=D.count);return I+R},0);c(x,v,"granite-omnisearch-facet-labelcount")}}):e(".granite-omnisearch-predicates coral-accordion-item").each(function(){var v=e(this);r.some(function(x){var A=u.get(x);return A&&0<A.count&&0<v.has(x).length})&&v.prop("selected",!0)})}var u=new WeakMap,q={"default":{getCount:function(l,H){var r=h(H,l.predicate);l=l.buckets.find(function(v){return r.value===
v.value});return{count:l?l.count:0,key:l?"equals--"+l.value:null}}},property:{getCount:function(l,H){var r=h(H,l.predicate,"value",!0);H=h(H,l.predicate,"operation");return H&&"equals"!==H.value?"exists"!==H.value||r&&"true"!==r.value?null:{count:l.buckets.reduce(function(v,x){return v+x.count},0),key:"exists--true"}:(l=l.buckets.find(function(v){return r.value===v.value}),{count:l?l.count:0,key:l?"equals--"+l.value:null})}}},y=/^(.+_)?(.+)$/;e(f).adaptTo("foundation-registry").register("foundation.adapters",
{type:"granite-omnisearch-internal-facets",selector:e(f),adapter:function(){return{updateCount:function(l,H){if(l){void 0===H.showAggregateCount&&(H.showAggregateCount=!0);var r=Object.keys(l).reduce(function(v,x){v.push({predicate:x,buckets:l[x]});return v},[]);d();r=b(r,H);g(r,H)}else d()}}}})})(window,Granite.$);
(function(f,e){function h(d){return Object.keys(d).find(function(b){b=b.split("_");return 1===b.length&&"fulltext"===b[0]||2===b.length&&"fulltext"===b[1]})}e(f).on("granite-omnisearch-predicate-update",function(d){d=d.detail.queryParameters;var b=h(d),c=f.querySelector(".granite-omnisearch-typeahead .granite-omnisearch-typeahead-input");b&&c&&(c.value=d[b])});e(f).on("granite-omnisearch-predicate-clear",function(d){d.detail.reset&&(d.target.querySelector(".granite-omnisearch-typeahead .granite-omnisearch-typeahead-input").value=
"")})})(document,Granite.$);
(function(f,e){function h(b){b=b?Granite.I18n.get("Location: {0} | AEM Search",b):Granite.I18n.get("AEM Search");var c=History.getState();History.replaceState(c.data,b)}function d(b,c,g,u){var q=f.querySelector(".granite-omnisearch-form").querySelector("#granite-omnisearch-field-location");if(!q||q.value!==b){q=g?g.dataset.graniteOmnisearchTypeaheadSuggestionTag:Granite.I18n.get("Location");g=g?g.dataset.graniteOmnisearchTypeaheadSuggestionValue:c;var y=f.querySelector(".granite-omnisearch-form"),l=
y.querySelector("#granite-omnisearch-field-location");null===l&&(l=f.createElement("input"),l.id="granite-omnisearch-field-location",l.type="hidden",l.name="location",y.appendChild(l));l.value=b;y=f.querySelector(".granite-omnisearch-form");l=y.querySelector("#granite-omnisearch-field-location-suggestion");null===l&&(l=f.createElement("input"),l.id="granite-omnisearch-field-location-suggestion",l.type="hidden",l.name="location.suggestion",y.appendChild(l));l.value=g;y=f.querySelector(".granite-omnisearch-form").querySelector(".granite-omnisearch-typeahead-tags");
l=y.querySelector("#granite-omnisearch-field-locationtag");null===l&&(l=new Coral.Tag,l.id="granite-omnisearch-field-locationtag",y.items.add(l));e(l.label).empty().append(e(f.createElement("span")).addClass("u-coral-text-capitalize u-coral-text-italic u-coral-text-secondary").text(q+": ")).append(e(f.createElement("span")).text(g));u&&(c={value:b,label:c},u=History.getState(),u.data.omnisearch=u.data.omnisearch||{},u.data.omnisearch.location=c,History.replaceState(u.data,u.title));e(f).trigger({type:"granite-shell-omnisearch-predicate-location:updated",
detail:{location:b}})}}e(f).on("granite-omnisearch-predicate-update",function(b){var c=b.detail.item;if(!c||"location"===c.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid){var g=b.detail.queryParameters;b=g.location;g=g["location.suggestion"];b&&(h(b),d(b,g,c,!0))}});e(f).on("granite-shell-omnisearch-predicate-location:update",function(b){b.stopImmediatePropagation();d(b.detail.location,b.detail.locationSuggestion)});e(f).on("granite-omnisearch-predicate-clear",function(b){var c=b.target;
if((b=b.detail.item)&&b.matches("#granite-omnisearch-field-locationtag")){var g=c.querySelector("#granite-omnisearch-field-location");c=c.querySelector("#granite-omnisearch-field-location");g.remove();c.remove();b.remove();h();e(f).trigger("granite-shell-omnisearch-predicate-location:cleared")}})})(document,Granite.$);
(function(f,e,h,d,b){function c(z){return z.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$\x26")}function g(z,C){return Object.keys(z).reduce(function(F,p){p=z[p];p.href&&p.title?F.push({title:C?C+" \u203a "+p.title:p.title,href:p.href,icon:p.icon}):"object"===typeof p&&(F=F.concat(g(p,C?C+" \u203a "+p.title:p.title)));return F},[])}function u(z){return function(C,F){if(z===C.suggestion)return-1;if(z===F.suggestion)return 1;var p=C.suggestion.toLowerCase().indexOf(z.toLowerCase()),E=F.suggestion.toLowerCase().indexOf(z.toLowerCase());
return p===E?-(F.suggestion.length-C.suggestion.length):p-E}}function q(z,C){var F=new RegExp(C.split(" ").map(function(p){return"(?\x3d.*"+p+")"}).join("")+".+","gi");return z.filter(function(p){return F.test(p.title)})}function y(z){var C;h.UI.Foundation.Utils.everyReverse(D.get("foundation.omnisearch.navigation.suggestions"),function(F){F.name===z&&(C=F.handler(C))});return C||null}function l(z,C,F,p){F=c(F);C=q(C||[],F);var E=z.predicateSuggestions&&0<z.predicateSuggestions.length?8:9;return C.filter(function(){return!(p++>=
E)})}function H(z,C,F,p){var E=c(F),K=new RegExp("("+E.split(" ").join("|")+")","gi");return l(z,C,F,p).map(function(S,X){var M=new e.SelectList.Item,O=h.HTTP.externalize(S.href);M.value=S.value;M.id="granite-omnisearch-suggestion-item-"+(p+X);M.content.innerHTML="\x3ccoral-icon size\x3d'S' icon\x3d'"+S.icon+"'\x3e\x3c/coral-icon\x3e\x3cspan class\x3d'granite-omnisearch-typeahead-suggestions-tip'\x3e"+h.I18n.get("Press Enter to navigate")+"\x3c/span\x3e"+h.I18n.get("Go to")+" "+S.title.replace(K,
"\x3cspan class\x3d'u-coral-text-secondary'\x3e$1\x3c/span\x3e");M.setAttribute("data-granite-omnisearch-typeahead-navigation","");M.setAttribute("data-granite-omnisearch-typeahead-navigation-href",O);return M})}function r(z,C,F){return(z&&z.predicateSuggestions?z.predicateSuggestions:[]).filter(function(){return!(9<=F++)})}function v(z,C,F){var p=c(C),E=new RegExp("("+p.split(" ").join("|")+")","gi");return r(z,C,F).map(function(K,S){var X=h.HTTP.externalize(K.href),M=new e.SelectList.Item;M.value=
K.value;M.id="granite-omnisearch-suggestion-item-"+(F+S);M.href=X;M.content.innerHTML="\x3cspan class\x3d'granite-omnisearch-typeahead-suggestions-tip'\x3e"+h.I18n.get("Press Tab to add")+"\x3c/span\x3e\x3ccoral-tag size\x3d'M'\x3e\x3cspan class\x3d'u-coral-text-capitalize u-coral-text-secondary u-coral-text-italic'\x3e"+K.type+" : \x3c/span\x3e"+K.value.replace(E,"\x3cspan class\x3d'u-coral-text-secondary'\x3e$1\x3c/span\x3e")+"\x3c/coral-tag\x3e";M.setAttribute("data-granite-omnisearch-typeahead-suggestion-predicateid",
K.typePath||""!==K.queryParameters.location?"location":K.type);M.setAttribute("data-granite-omnisearch-typeahead-suggestion-tag",K.type);M.setAttribute("data-granite-omnisearch-typeahead-suggestion-value",K.value);d(M).data("granite-omnisearch-typeahead-suggestion-queryparameters",K.queryParameters);return M})}function x(z,C,F){var p=[];z&&z.suggestions&&(C=u(C),p=z.suggestions,p=p.sort(C).filter(function(E,K,S){return!K||E.suggestion!==S[K-1].suggestion}));return p.filter(function(){return!(9<=F++)})}
function A(z,C,F){var p=c(C),E=new RegExp("("+p.split(" ").join("|")+")","gi");return x(z,C,F).map(function(K,S){var X=d("\x3cdiv\x3e").text(K.suggestion).html(),M=new e.SelectList.Item;M.value=K.value;M.id="granite-omnisearch-suggestion-item-"+(F+S);M.content.innerHTML=X.replace(E,"\x3cspan class\x3d'u-coral-text-secondary'\x3e$1\x3c/span\x3e");return M})}function L(){var z=f.querySelector(".granite-omnisearch-overlay").querySelector(".granite-omnisearch-form"),C=z.querySelector(".granite-omnisearch-typeahead");
return(C=b.expand(C.dataset.graniteOmnisearchTypeaheadSrc))?d.ajax({url:C,method:d(z).attr("method"),data:d(z).serialize()}).then(function(F){return F}):Promise.resolve([])}function I(z,C){var F=[];return Promise.all([R(),L()]).then(function(p){var E=y(z);E||(E=p[0]);return(p=p[1])?(F=F.concat(H(p,E,C,0)),F=F.concat(v(p,C,F.length)),F=F.concat(A(p,C,F.length))):[]}).catch(function(){return[]})}var D=d(window).adaptTo("foundation-registry"),R=function(){var z;return function(){if(!z){var C=f.querySelector(".granite-omnisearch-overlay").dataset.graniteOmnisearchOverlayNavsrc;
return d.get(C).then(function(F){return z=g(F)})}return Promise.resolve(z)}}();D.register("foundation.adapters",{type:"granite-shell-omnisearch-suggestions",selector:d(window),adapter:function(){return{getSuggestions:function(z,C){return C?L(z,C):Promise.resolve([])},getWrappedSuggestions:function(z,C){return C?I(z,C):Promise.resolve([])}}}})})(document,Coral,Granite,Granite.$,Granite.URITemplate);
(function(f,e,h,d,b){function c(){var a=m.elements.input;a&&window.requestAnimationFrame(function(){a.focus()})}function g(){var a=d(m.elements.form).serializeArray().find(function(k){return"location"===k.name});return a?a.value:void 0}function u(a){if(a&&a.collection)return a.collection.index||null;a=History.getState();return a.data&&a.data.omnisearch&&a.data.omnisearch.collection?a.data.omnisearch.collection.index||null:null}function q(a,k){if(a&&k&&f.body.contains(a)&&f.body.contains(k)){var w=
d(a).position();w.top+a.offsetHeight>=k.offsetHeight?(a=a.offsetTop+a.offsetHeight-k.offsetHeight,k.scrollTop=a):0>w.top&&(a=a.offsetTop,k.scrollTop=a)}}function y(){var a=m.elements.input;if(a){if("selectionStart"in a)return a.selectionStart;if(f.selection){if(f.activeElement!==a)return-1;var k=f.selection.createRange(),w=k.text.length;k.moveStart("character",-a.value.length);return k.text.length-w}}else return-1}function l(){e.commons.nextFrame(function(){var a=m.elements.input,k=m.elements.tagList,
w=m.elements.tagListHolder,n=m.elements.tagListHolderList,t=m.elements.tagListHolderLabel,B=m.elements.tagListHolderPopover;if(a&&k)if(200>=a.clientWidth-k.offsetWidth){if(a=k.querySelector("coral-tag:not([name\x3d'location']):not([hidden])"))t.textContent=Number(t.textContent)+1,n=n.items.add({type:"button",content:{innerHTML:a.label.innerHTML+"\x3ccoral-icon class\x3d'granite-omnisearch-typeahead-tags-holder-list-remove' icon\x3d'closeCircle' size\x3d'XS'\x3e\x3c/coral-icon\x3e"}}),d(n).data("graniteOmnisearchTagsHolderItemTag",
{tag:a,width:a.getBoundingClientRect().width}),w.closable=!1,w.hidden=!1,a.hidden=!0}else{var G=n.items.last();if(G){var Q=d(G).data("graniteOmnisearchTagsHolderItemTag");Q&&Q.tag.hidden&&200<a.clientWidth-k.offsetWidth-Q.width&&(Q.tag.hidden=!1,n.items.remove(G),n.items.length?t.textContent=Number(t.textContent)-1:(B.open=!1,w.hidden=!0,t.textContent=""))}d(a).css("padding-left",k.offsetWidth+36)}})}function H(a){var k=f.querySelector(".granite-shell-header");k&&(k.style.visibility=a?"hidden":"")}
function r(a){var k=m.elements.input,w=m.elements.selectList;k.setAttribute("aria-expanded",!0);k.setAttribute("aria-controls",w.id);k.setAttribute("aria-activedescendant",a.id);a.setAttribute("aria-live","polite");w.setAttribute("aria-label",h.I18n.get("AEM Search")+": "+k.value)}function v(){var a=m.elements.input,k=m.elements.selectList;a.setAttribute("aria-expanded",!1);a.removeAttribute("aria-controls");a.removeAttribute("aria-activedescendant");k.setAttribute("aria-label",h.I18n.get("AEM Search"))}
function x(a){if(a.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid){a.dataset.graniteOmnisearchTypeaheadSuggestionKeepinput||(m.elements.input.value="");var k=d(a).data("granite-omnisearch-typeahead-suggestion-queryparameters");A(a,k)}}function A(a,k,w){var n=m.elements.tagList;d(m.elements.form).trigger({type:"granite-omnisearch-predicate-update",detail:{item:a,tagList:n,queryParameters:k,tagsPredicateData:w||{}}})}function L(){var a={},k=m.elements.tagList.querySelectorAll("coral-tag");
Array.prototype.forEach.call(k,function(w){(w=d(w).data("graniteOmnisearchTagPredicateData"))&&(a[w.name]=w)});return a}function I(a){var k=a.formData,w=a.tagsPredicateData;m.restored=!0;a=function(n){var t=m.elements.form,B=t.action;if(n){var G=parseInt(History.getState().data.omnisearch.collection.limit,10)||100;t.action=B.substr(0,B.lastIndexOf("."))+".0."+Math.ceil(n/G)*G+B.substr(B.lastIndexOf("."),B.length)}return function(){t.action=B}}(u(a));k=k.reduce(function(n,t){n[t.name]=t.value;return n},
{});A(void 0,k,w);D();a()}function D(){var a=m.elements.form;R();d(a).submit()}function R(){var a=m.elements.typeaheadOverlay;clearTimeout(ea);v();a.hide()}function z(){var a=m.elements.typeahead,k=m.elements.form,w=m.elements.input.value;if(a)if(v(),w.length<m.omnisearchMinLength)R();else if(b.expand(a.dataset.graniteOmnisearchTypeaheadSrc,{query:d(k).serialize()}))return d(window).adaptTo("granite-shell-omnisearch-suggestions").getWrappedSuggestions(g(),w).then(function(n){var t=m.elements.selectList,
B=m.elements.typeaheadOverlay;if(m.open&&!m.closed){t.items.clear();n.forEach(function(Q){t.items.add(Q)});t.style.height="";var G=window.getComputedStyle(t);n=parseInt(G.height,10);G=parseInt(G.maxHeight,10);n<G&&(t.style.height=n+"px");0<t.items.length&&(n=t.items.getAll()[0],r(n),B.open=!0)}})}function C(a){var k=m.elements.overlay,w=k.querySelector("#granite-omnisearch-result-rail");if(a&&m.open){var n=k.dataset.graniteOmnisearchOverlayPredicatesrc;if(!n)return Promise.reject();a=b.expand(n,{location:a});
return d.ajax({url:a,cache:!1}).then(function(t){return d(window).adaptTo("foundation-util-htmlparser").parse(t).then(function(B){B=B.querySelector("#granite-omnisearch-result-rail");w.replaceWith(B);d(B).trigger("foundation-contentloaded");m.showRail&&(B=k.querySelector("#granite-omnisearch-result-rail-toggle"))&&(B.items.getAll()[1].selected=!0,m.showRail=!1)})})}return Promise.resolve()}function F(){var a=m.vent,k=function(t){window.clearTimeout(ea);ea=window.setTimeout(z,300)},w=function(t){if("Escape"===
t.key){var B=m.elements.overlay,G=m.elements.typeaheadOverlay;m.open&&!m.closed&&(G&&G.open&&G._isTopOverlay()?(t.preventDefault(),R()):B._isTopOverlay()&&(B=B.querySelector("#granite-omnisearch-result"),0===d(B).adaptTo("foundation-selections").count()&&(t.preventDefault(),ia())))}},n=function(t){function B(P){0===y(U)&&""===window.getSelection().toString()&&((P=da.items.last())&&P.remove(),z());U.value.match('^"(.+)"$')&&(U.value="")}function G(P){J.open&&(P=W.querySelector("coral-selectlist-item.is-highlighted"))&&
P.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid&&(x(P),z())}function Q(P){if(J.open&&(P=W.querySelector("coral-selectlist-item.is-highlighted"))){P.click();return}D()}function N(P){if(J.open){P=W.querySelector("coral-selectlist-item.is-highlighted");var Y=W.items.getAll(),ba=Y.indexOf(P);P&&P.classList.remove("is-highlighted");0!==Y.length&&(P=0<ba?Y[ba-1]:Y[Y.length-1],P.classList.add("is-highlighted"),U.setAttribute("aria-activedescendant",P.getAttribute("id")),q(P,J))}}function T(P){if(J.open){P=
W.querySelector("coral-selectlist-item.is-highlighted");var Y=W.items.getAll(),ba=Y.indexOf(P);P&&P.classList.remove("is-highlighted");0!==Y.length&&(P=ba<Y.length-1?Y[ba+1]:Y[0],P.classList.add("is-highlighted"),U.setAttribute("aria-activedescendant",P.getAttribute("id")),q(P,J))}else z()}var V=!0,U=m.elements.input,W=m.elements.selectList,J=m.elements.typeaheadOverlay,da=m.elements.tagList;switch(t.keyCode){case 8:V=!1;B(t);break;case 9:V=J.open?V:!1;G(t);break;case 13:Q(t);break;case 38:J.open&&
(V=!1);N(t);break;case 40:J.open&&(V=!1);T(t);break;default:V=!1}V&&t.preventDefault()};a.on("input",".granite-omnisearch-typeahead-input",k);a.on("keydown",".granite-omnisearch-typeahead-input",n);a.on("keydown",w,!0);return function(){a.off("input",".granite-omnisearch-typeahead-input",k);a.off("keydown",".granite-omnisearch-typeahead-input",n);a.off("keydown",w,!0)}}function p(){var a=m.vent,k=function(t){t.detail.item.multiline=!1;l()},w=function(t){l();t=t.detail.item;var B=m.elements.tagList;
d(m.elements.form).trigger({type:"granite-omnisearch-predicate-clear",detail:{item:t,tagList:B}})},n=function(t){z()};a.on("coral-collection:add",".granite-omnisearch-typeahead-tags",k);a.on("coral-collection:remove",".granite-omnisearch-typeahead-tags",w);a.on("change",".granite-omnisearch-typeahead-tags",n);return function(){a.off("coral-collection:add",".granite-omnisearch-typeahead-tags",k);a.off("coral-collection:remove",".granite-omnisearch-typeahead-tags",w);a.off("change",".granite-omnisearch-typeahead-tags",
n)}}function E(){var a=m.vent,k=function(t){t=t.matchedTarget.selectedItem;var B=m.elements.input;t&&("undefined"!==typeof t.dataset.graniteOmnisearchTypeaheadNavigation?window.location=t.dataset.graniteOmnisearchTypeaheadNavigationHref:(t.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid?x(t):B.value=t.value||t.content.textContent,D()))},w=function(t){m.elements.input.setAttribute("aria-activedescendant",t.target.getAttribute("id"))},n=function(t){t=t.target;var B=m.elements.input,G=m.elements.typeaheadOverlay;
B&&B.contains(t)||null===G||!G.open||G.contains(t)||R()};a.on("coral-selectlist:change",".granite-omnisearch-typeahead-overlay coral-selectlist",k);d(f).on("mouseenter",".granite-omnisearch-typeahead-overlay coral-selectlist coral-selectlist-item",w);f.addEventListener("click",n);return function(){a.off("coral-selectlist:change",".granite-omnisearch-typeahead-overlay coral-selectlist",k);d(f).on("mouseenter",".granite-omnisearch-typeahead-overlay coral-selectlist coral-selectlist-item",w);f.removeEventListener("click",
n)}}function K(){var a=m.vent,k=function(){var w=event.matchedTarget,n=m.elements.tagList,t=m.elements.tagListHolderLabel,B=m.elements.tagListHolderList;if(1===B.items.length){var G=m.elements.tagListHolder;m.elements.tagListHolderPopover.open=!1;G.hidden=!0;t.textContent=""}else t.textContent=Number(t.textContent)-1;B.items.remove(w);n.items.remove(d(w).data("graniteOmnisearchTagsHolderItemTag").tag)};a.on("click",".granite-omnisearch-typeahead-tags-holder-list [coral-list-item]",k);return function(){a.off("click",
".granite-omnisearch-typeahead-tags-holder-list [coral-list-item]",k)}}function S(){var a=m.elements.form,k=function(w){w=w.target;var n=History.getState();n.data.omnisearch=n.data.omnisearch||{};n.data.omnisearch.formData=d(w).serializeArray();n.data.omnisearch.tagsPredicateData=L();History.replaceState(n.data,n.title)};d(a).on("submit",k);return function(){d(a).off("submit",k)}}function X(){e.commons.addResizeListener(m.elements.tagList,l);window.addEventListener("resize",l);return function(){window.removeEventListener("resize",
l)}}function M(){var a=m.collectionEl,k=function(w){var n=w.target;w=History.getState();var t=n.closest(".foundation-collection-item:not(.is-lazyLoaded)");n=d(a).adaptTo("foundation-collection").getPagination();t&&n&&(t=t.dataset.datasourceIndex,w.data.omnisearch=w.data.omnisearch||{},w.data.omnisearch.collection={index:t,limit:n.limit},History.replaceState(w.data,w.title))};a.addEventListener("click",k,!0);return function(){a.removeEventListener("click",k,!0)}}function O(){var a=m.collectionEl;h.UI.Foundation.Utils.everyReverse(m.stack.collection,
function(k){k&&k();return!0});m.stack.collection=[];a&&h.UI.Foundation.Layouts.cleanAll(this);window.setTimeout(function(k){k&&d(k).adaptTo("foundation-collection").clear()},1E3,a)}function aa(a){!0===a?(d("coral-shell").addClass("non-visible"),d(".granite-skipNavigationLinks").addClass("non-visible")):(d("coral-shell").removeClass("non-visible"),d(".granite-skipNavigationLinks").removeClass("non-visible"))}function Z(a){var k=m.metadata;if(m.open)return l(),c(),Promise.resolve();if(!k||!k.dataset.graniteOmnisearchSrc)return Promise.reject();
m.open=!0;k=k.dataset.graniteOmnisearchSrc;H(!0);aa(!0);if(a&&a.location){var w=a.location.value;var n=a.location.label}else{var t=f.head.querySelector(".granite-omnisearch-location");t&&(w=t.dataset.graniteOmnisearchLocationValue,n=t.dataset.graniteOmnisearchLocationLabel)}k=b.expand(k,{location:w});return d.get(k).then(function(B){return d(window).adaptTo("foundation-util-htmlparser").parse(B)}).then(function(B){if(B=B.querySelector(".granite-omnisearch-overlay"))return d(B).css("zIndex",f.querySelector("coral-shell-header").style.zIndex+
10),m.init(B),m.stack.open.push(F()),m.stack.open.push(p()),m.stack.open.push(E()),m.stack.open.push(K()),m.stack.open.push(S()),m.stack.open.push(X()),m.closable||(m.elements.close.hidden=!0),f.body.appendChild(B),d(B).trigger("foundation-contentloaded"),l(),c(),w&&n&&d(f).trigger({type:"granite-shell-omnisearch-predicate-location:update",detail:{location:w,locationSuggestion:n}}),fa}).then(function(){if(a)a.formData&&I(a);else{window.location.pathname.startsWith(m.searchURL)||window.sessionStorage.setItem("granite.shell.omnisearch.pathWhenOpeningOmnisearch",
window.location.pathname);var B=w?h.I18n.get("Location: {0} | AEM Search",w):h.I18n.get("AEM Search");History.pushState({omnisearch:{referrer:!0,location:{value:w,label:n}}},B,m.searchURL)}})}function ca(){m.destroy();var a=f.getElementById("shell-collectionpage-rail-toggle");a&&(a.items.getAll()[0].selected=!0);var k=f.getElementById("granite-omnisearch-trigger");ha&&k&&(ha=!1,window.setTimeout(function(){var w=k.querySelector("button");k.open=!1;w.focus();w.classList.add("focus-ring")},100));H(!1);
aa(!1);fa=Promise.resolve()}function ia(){if(m.closable&&!m.closed)if(m.closed=!0,v(),m.restored){var a=window.sessionStorage.getItem("granite.shell.omnisearch.pathWhenOpeningOmnisearch");History.pushState({},null,a)}else History.back()}function ja(){var a=m.elements.form.querySelector("#granite-omnisearch-is-opened-filter");null!==a&&a.remove()}var ea,ha=!1,fa=Promise.resolve(),m=new function(){function a(){Object.keys(W).forEach(function(J){h.UI.Foundation.Utils.everyReverse(W[J],function(da){da&&
da();return!0})})}function k(){n={};t=B=G=T=!1;Q=!0;N=null;W={open:[],collection:[]};V=null}function w(){Object.keys(n).forEach(function(J){(J=n[J])&&J.remove()})}var n,t,B,G,Q,N,T,V,U,W;k();return{get open(){return t||!1},set open(J){t=!!J},get elements(){return n||{}},get metadata(){return f.querySelector(".granite-omnisearch-src")},get vent(){return N},get closable(){return Q},set closable(J){Q=!!J},get showRail(){return G},set showRail(J){G=!!J},get stack(){return W},get searchURL(){return this.metadata?
this.metadata.dataset.graniteOmnisearchSearchUrl:null},get restored(){return B},set restored(J){B=!!J},get closed(){return T},set closed(J){T=!!J},get collectionEl(){return V},get omnisearchMinLength(){return U},set collectionEl(J){V=J},init:function(J){a();n.overlay=J;n.form=J.querySelector(".granite-omnisearch-form");n.typeahead=n.form.querySelector(".granite-omnisearch-typeahead");n.input=n.typeahead.querySelector(".granite-omnisearch-typeahead-input");n.tagList=n.typeahead.querySelector(".granite-omnisearch-typeahead-tags");
n.tagListHolder=n.typeahead.querySelector(".granite-omnisearch-typeahead-tags-holder");n.tagListHolderLabel=n.typeahead.querySelector(".granite-omnisearch-typeahead-tags-holder-label");n.tagListHolderPopover=J.querySelector(".granite-omnisearch-typeahead-tags-holder-popover");n.tagListHolderList=n.tagListHolderPopover.querySelector(".granite-omnisearch-typeahead-tags-holder-list");n.selectList=n.typeahead.querySelector(".granite-omnisearch-typeahead-suggestions");n.typeaheadOverlay=n.typeahead.querySelector(".granite-omnisearch-typeahead-overlay");
n.close=n.typeahead.querySelector(".granite-omnisearch-typeahead-close");U=J.getAttribute("omnisearchMinLength");N=new Vent(J)},destroy:function(){a();N&&N.destroy();O();w();k()}}};d(window).adaptTo("foundation-registry").register("foundation.form.response.ui.success",{name:"granite.omnisearch.result",handler:function(a,k,w,n,t,B){d(window).adaptTo("foundation-util-htmlparser").parse(B).then(function(G){var Q=m.elements.overlay.querySelector(".granite-omnisearch-content");ja();var N=Q.querySelector("#granite-omnisearch-result-actionbar"),
T=G.querySelector("#granite-omnisearch-result-actionbar");N?N.querySelector("#granite-omnisearch-result-rail-toggle")?N.querySelector("betty-titlebar-secondary").replaceWith(T.querySelector("betty-titlebar-secondary")):T?N.replaceWith(T):N.remove():T&&Q.querySelector("#granite-omnisearch-result-header").appendChild(T);N=Q.querySelector("#granite-shell-search-result-selectionbar");T=G.querySelector("#granite-shell-search-result-selectionbar");N&&T?N.replaceWith(T):N?N.remove():T&&Q.appendChild(T);
var V=G.querySelector("#granite-omnisearch-facet");N=d(window).adaptTo("granite-omnisearch-internal-facets");V?(T=JSON.parse(V.dataset.graniteOmnisearchFacetConfig),V=JSON.parse(V.dataset.graniteOmnisearchFacetFacets),N.updateCount(V,T)):N.updateCount(null);N=Q.querySelector("#granite-omnisearch-result-content");G=G.querySelector("#granite-omnisearch-result-content");O();N.replaceWith(G);var U=G.querySelector(".granite-omnisearch-result.foundation-collection");N=d(U);m.collectionEl=U;var W=u();if(W){T=
JSON.parse(U.dataset.foundationLayout);if(V=History.getState().data.omnisearch.collection.limit)T.limit=V;U.dataset.foundationLayout=JSON.stringify(T);N.removeData("foundation-layout");N.data("foundation-layout",T)}U&&m.stack.collection.push(M());U&&"true"===G.dataset.supportSorting&&(G=JSON.parse(U.dataset.foundationLayout),G.sortMode="remote",U.dataset.foundationLayout=JSON.stringify(G),N.removeData("foundation-layout"),N.data("foundation-layout",G));Q.hidden=!1;d(Q).trigger("foundation-contentloaded");
G=f.querySelectorAll(".foundation-collection");Array.prototype.forEach.call(G,function(J){(J=d(J).adaptTo("foundation-selections"))&&J.clear()});W&&(window.requestAnimationFrame(function(){var J=U.querySelector("[data-datasource-index\x3d'"+W+"']");J&&d(U.scrollContainer).animate({scrollTop:J.getClientRects()[0].top-U.scrollContainer.getClientRects()[0].top},0)}),G=History.getState(),delete G.data.omnisearch.collection,History.replaceState(G.data,G.title));(Q=Q.querySelector("#granite-omnisearch-result-rail-toggle"))&&
m.showRail&&(Q=Q.items.getAll()[1],Q.dataset.graniteToggleableControlTarget&&(Q.selected=!0,m.showRail=!1))})}});d(function(){if(m.metadata&&window.location.pathname.startsWith(m.searchURL)){var a=History.getState().data.omnisearch;m.closable=a&&a.referrer;Z(a||{})}});d(window).on("statechange",function(){var a=History.getState().data.omnisearch;if(a)m.open||Z(a);else if(m.open||m.closed)(a=f.head.querySelector("meta[name\x3d'granite.omnisearch.searchpage']"))&&"true"===a.content?window.location.reload():
ca()});d(f).on("coral-overlay:beforeopen",".granite-omnisearch-multiresult-row coral-quickactions",function(a){a.preventDefault()});d(f).on("click",".granite-omnisearch-viewall-button",function(a){a.preventDefault();a=a.currentTarget;var k=a.dataset.graniteOmnisearchTypeaheadSuggestionPredicateid,w=JSON.parse(a.dataset.graniteOmnisearchTypeaheadSuggestionQueryparameters);k&&(A(a,w),D())});d(f).on("foundation-mode-change",function(a,k,w){if(a=f.querySelector(".granite-omnisearch-typeahead"))a.style.visibility=
"selection"===k?"hidden":""});d(f).on("coral-cyclebutton:change",".granite-collection-switcher[data-granite-collection-switcher-target\x3d'#granite-omnisearch-result']",function(a){O();var k=function(n){n=n.target;var t=d(n),B=JSON.parse(n.dataset.foundationLayout),G=n.closest("#granite-omnisearch-result-content");m.collectionEl.nodeName!==n.nodeName&&(m.collectionEl=n,m.stack.collection.push(M()),G&&"true"===G.dataset.supportSorting&&"remote"!==B.sortMode&&(B.sortMode="remote",n.dataset.foundationLayout=
JSON.stringify(B),t.removeData("foundation-layout"),t.data("foundation-layout",B)),d(f).off("foundation-contentloaded","#granite-omnisearch-result",k),window.clearTimeout(w))};var w=window.setTimeout(function(){d(f).off("foundation-contentloaded","#granite-omnisearch-result",k)},5E3);d(f).on("foundation-contentloaded","#granite-omnisearch-result",k)});d(f).on("foundation-layout-perform","#granite-omnisearch-result",function(a){a=JSON.parse(a.target.dataset.foundationLayout);d.cookie("shell.omnisearch.results.layoutId",
a.layoutId,{path:"/"})});d(f).on("granite-shell-omnisearch-predicate-location:updated",function(a){a.stopImmediatePropagation();fa=C(a.detail.location)});d(f).on("granite-shell-omnisearch-predicate-location:cleared",function(a){a.stopImmediatePropagation();a=m.elements.overlay;var k=a.querySelector("#granite-omnisearch-result-rail");k=d(k);var w=k.adaptTo("foundation-toggleable");(a=a.querySelector("#granite-omnisearch-result-rail-toggle"))&&a.remove();w.hide();k.empty();m.elements.tagList.items.clear()});
d(f).on("granite-omnisearch-predicate-clear",function(a){var k=a.detail.tagList;a.detail.reset&&k.items.getAll().forEach(function(w){w.matches("#granite-omnisearch-field-locationtag")||w.remove()})});d(function(){if(d(window).adaptTo("foundation-preference").getBoolean("shortcutsEnabled",!0))e.keys.on("/",function(a){var k=m.elements.typeahead;k&&k.contains(f.activeElement)||m.open||d(".granite-collection-selectionbar \x3e .foundation-mode-switcher-item-active").length||(a.preventDefault(),Z())})});
d(f).on("click","#granite-omnisearch-trigger",function(a){a.preventDefault();ha=!0;Z()});d(f).on("coral-cyclebutton:change","#granite-shell-actionbar .granite-toggleable-control",function(a){if(a=a.originalEvent.detail.selection.dataset.graniteOmnisearchFilter){var k=f.querySelector(a).dataset.foundationCollectionId;m.showRail=!0;Z().then(function(){A(void 0,{_path:k});var w=m.elements.form,n=w.querySelector("#granite-omnisearch-is-opened-filter");null===n&&(n=f.createElement("input"),n.id="granite-omnisearch-is-opened-filter",
n.type="hidden",n.name="opened-through-filter",n.value=!0,w.appendChild(n));D()})}});d(f).on("granite-omnisearch-external-search",function(a){var k=a.detail.queryParams;Z().then(function(){A(void 0,k);D()})});d(f).on("click",".granite-omnisearch-typeahead-close",function(a){a.preventDefault();ia()})})(document,Coral,Granite,Granite.$,Granite.URITemplate);
(function(f,e){e(f).adaptTo("foundation-registry").register("foundation.adapters",{type:"foundation-collection-item-action",selector:"#granite-omnisearch-result-content .foundation-collection",adapter:function(h){return{execute:function(d){var b;if(b=d.classList.contains("foundation-collection-navigator")?d:d.querySelector(".foundation-collection-navigator")){var c=b.dataset.foundationCollectionNavigatorHref;var g=b.dataset.foundationCollectionNavigatorTarget}c||(c=e(d).find("link[rel\x3dproperties]").attr("href"));
c&&f.open(c,g||"_self")}}}})})(window,Granite.$);
(function(f,e,h,d,b,c){function g(r,v){v&&u(r);f.UNIFIED_SHELL&&UNIFIED_SHELL.ENABLED||(r.intervalId=setInterval(function(){r.badgeEl&&(e.contains(r.badgeEl)?u(r,!0).fail(function(x,A){x&&404===x.status&&clearInterval(r.intervalId)}):(r.badgeMenu&&r.badgeMenu.remove(),l.delete(r.badgeEl),clearInterval(r.intervalId)))},2E3))}function u(r,v){var x=r.badgeEl;return q(r,v).then(function(A){A=A.total;var L=x.dataset.graniteShellBadgeLabelTemplate;x.setAttribute("badge",A);L&&x.setAttribute("aria-label",
L.replace("{{count}}",A))})}function q(r,v){var x=r.badgeEl,A=r.user,L=r.src,I=H.get(x),D=f.sessionStorage.getItem("granite.shell.badge.user"),R=parseInt(f.sessionStorage.getItem("granite.shell.badge.timestamp"),10);if(!(D!==A||isNaN(R)||R+6E4<=Date.now())||D===A&&I&&"pending"===I.state()){if(v)return h.Deferred().reject().promise();if(I=f.sessionStorage.getItem("granite.shell.badge.data"))return h.Deferred().resolve(JSON.parse(I)).promise()}I=h.ajax({url:L,cache:!1,timeout:6E4});H.set(x,I);return I.then(function(z){try{if(v){var C=
JSON.parse(f.sessionStorage.getItem("granite.shell.badge.data"));b.AsyncUtil.displayPopupNotifications(z,C)}r.dirty=!0;f.sessionStorage.setItem("granite.shell.badge.user",A);f.sessionStorage.setItem("granite.shell.badge.timestamp",Date.now());f.sessionStorage.setItem("granite.shell.badge.data",JSON.stringify(z))}catch(F){console.warn("Notification data could not be stored.",F)}return z})}function y(r){var v=new c.Shell.Menu,x=r.data;r=r.total;v.placement=c.Overlay.placement.RIGHT;v.classList.add("foundation-toggleable",
"foundation-layout-util-maxheight80vh","foundation-layout-util-width300","foundation-layout-util-breakword");v.setAttribute("aria-live","off");v.setAttribute("aria-labelledby","granite-shell-badge-trigger");x&&x.forEach(function(A){var L=c.commons.getUID(),I=h(e.createElement("div")).addClass("granite-shell-badge-item"),D=h(e.createElement("a")).addClass("granite-shell-badge-item-link").attr("href",A.detailsUrl);I.context.style.backgroundImage="url("+A.backgroundImageUrl+")";I.context.style.backgroundSize=
"36px 36px";I.context.style.backgroundRepeat="no-repeat";I.context.style.backgroundPosition="0px 4px";A.title&&(h(e.createElement("span")).attr("id","title_"+L).addClass("granite-shell-badge-item-title").html(A.title).appendTo(I),D.attr("aria-labelledby","title_"+L));if(A.description){var R=h(e.createElement("span")).attr("id","description_"+L).addClass("granite-shell-badge-item-description"),z=R.text;A=A.description;A=(new DOMParser).parseFromString(A,"text/html").documentElement.textContent;z.call(R,
A).appendTo(I);D.attr("aria-describedby","description_"+L)}D.appendTo(I);I.appendTo(v)});h(e.createElement("div")).addClass("granite-shell-badge-item-inbox").appendTo(v).append(h(e.createElement("a")).text(b.I18n.get("View All ({0} New)",r,"link to notification inbox")).addClass("granite-shell-badge-console granite-shell-badge-item-link")).attr("aria-label",b.I18n.get("View All ({0} New)",r,"link to notification inbox"));return v}var l=new WeakMap,H=new WeakMap;h(e).on("click",".granite-shell-badge",
function(r){r.preventDefault();var v=l.get(this),x=v.badgeEl;r=v.user;if(v.src&&r){var A=d.expand(x.dataset.graniteShellBadgeConsole,{ref:f.location.href});q(v).then(function(L){var I=v.badgeMenu;if("0"===L.total)f.location=A;else if(I){var D=h(I);I=D.adaptTo("foundation-toggleable");I.isOpen()?I.hide():(I=v.dirty?v.badgeMenu=y(L):v.badgeMenu,D=h(I),v.dirty=!1,D.find(".granite-shell-badge-console").attr("href",A),D.appendTo(e.body),requestAnimationFrame(function(){D.adaptTo("foundation-toggleable").show(x)}))}else I=
y(L),D=h(I),D.find(".granite-shell-badge-console").attr("href",A),D.appendTo(e.body),D.on("foundation-toggleable-hide",function(){D.detach()}),v.dirty=!1,requestAnimationFrame(function(){D.adaptTo("foundation-toggleable").show(x)}),v.badgeMenu=I},function(){f.location=A})}});h(e).on("foundation-contentloaded",function(r){r.target.querySelectorAll(".granite-shell-badge").forEach(function(v){var x=v.dataset.graniteShellBadgeSrc;x&&!l.has(v)&&(x={badgeEl:v,src:x,user:v.dataset.graniteShellBadgeUser},
x={badgeEl:x.badgeEl||void 0,badgeMenu:x.badgeMenu||void 0,dirty:x.dirty||!1,intervalId:x.intervalId||void 0,user:x.user||void 0,src:x.src||void 0},l.set(v,x),g(x,!0))})})})(window,document,Granite.$,Granite.URITemplate,Granite,Coral);
(function(f,e,h,d){h(f).adaptTo("foundation-registry").register("foundation.adapters",{type:"foundation-toggleable",selector:"coral-shell-menu.foundation-toggleable",adapter:function(c){var g=h(c);g.data("foundation-toggleable.internal.preventTargetClickHandling",!0);g.on("coral-overlay:open",function(u){if(u.target===c){if(u=d.Overlay._getTarget(c))u.open=!0;g.trigger("foundation-toggleable-show")}});g.on("coral-overlay:close",function(u){if(u.target===c){if(u=d.Overlay._getTarget(c))u.open=!1;g.trigger("foundation-toggleable-hide")}});
return{isOpen:function(){return c.open},show:function(u){u instanceof Element&&(c.target=u,c.show())},hide:function(){c.hide()}}}});var b=d.Shell.Menu.prototype._handleGlobalClick;d.Shell.Menu.prototype._handleGlobalClick=function(c){if(h(this).data("foundation-toggleable.internal.preventTargetClickHandling")){var g=this.target;if(g&&(g===c.target||g.contains(c.target)))return}return b.apply(this,arguments)}})(window,document,Granite.$,window.Coral);
(function(f,e,h){function d(u){var q=u.filter("#granite-shell-search-result-actionbar-center"),y=u.filter("#granite-shell-search-result-actionbar-right"),l=h("#granite-shell-actionbar"),H=l.children("betty-titlebar-title"),r=l.children("betty-titlebar-secondary");q.length&&(H.prop("hidden",!0).after(q),r.prop("hidden",!0).after(y));l.trigger("foundation-contentloaded");return{clean:function(){H.prop("hidden",!1);q.remove();r.prop("hidden",!1);y.remove()},replace:function(v){q=v.filter("#granite-shell-search-result-actionbar-center").replaceAll(q);
y=v.filter("#granite-shell-search-result-actionbar-right").replaceAll(y);l.trigger("foundation-contentloaded")}}}function b(u){var q=u.filter("#granite-shell-search-result-selectionbar");q.appendTo(e.body).trigger("foundation-contentloaded");return{clean:function(){q.remove()},replace:function(y){q=y.filter("#granite-shell-search-result-selectionbar").replaceAll(q).trigger("foundation-contentloaded")}}}function c(u){var q=u.filter("#granite-shell-search-result-content"),y=h("#granite-shell-content .foundation-layout-panel-content").prop("hidden",
!0);q.insertAfter(y).trigger("foundation-contentloaded");return{clean:function(){q.remove();y.prop("hidden",!1)},replace:function(l){q=l.filter("#granite-shell-search-result-content").replaceAll(q).trigger("foundation-contentloaded")}}}function g(){var u=h(e),q=u.data("granite-shell-search.internal.stack");q&&Granite.UI.Foundation.Utils.everyReverse(q,function(y){y.clean();return!0});u.removeData("granite-shell-search.internal.stack")}h(f).adaptTo("foundation-registry").register("foundation.form.response.ui.success",
{name:"granite.shell.search.result",handler:function(u,q,y,l,H,r){h(f).adaptTo("foundation-util-htmlparser").parse(r).then(function(v){var x=h(v).children();v=h(e);var A=v.data("granite-shell-search.internal.stack");A?A.forEach(function(L){L.replace(x)}):(A=[],A.push(d(x)),A.push(b(x)),A.push(c(x)),v.data("granite-shell-search.internal.stack",A))})}});h(e).on("click",".granite-shell-search-result-close",function(u){u.preventDefault();g()});h(e).on("foundation-toggleable-hide",".foundation-layout-panel-rail-panel",
function(u){0!==h(this).has(".granite-shell-search-form").length&&g()})})(window,document,Granite.$);
(function(f,e,h){function d(p,E,K){[].forEach.call(p.children,function(S){E!==S&&1===S.nodeType&&-1===I.indexOf(S.tagName.toLowerCase())&&K(S)})}function b(p,E){E&&(p?(void 0===E.dataset.cachedAriaHidden&&(E.dataset.cachedAriaHidden=E.getAttribute("aria-hidden")||""),E.setAttribute("aria-hidden","true")):(p=E.dataset.cachedAriaHidden,delete E.dataset.cachedAriaHidden,""===p||void 0===p?E.removeAttribute("aria-hidden"):E.setAttribute("aria-hidden",p)))}function c(p,E){d(p,E,function(K){b(!0,K)})}function g(p,
E){d(p,E,function(K){b(!1,K)})}function u(p){for(var E=p.parentNode;p!==f.body&&E;)c(E,p),p=E,E=p.parentNode}var q,y,l,H,r,v,x,A=!!e.CoachMark,L,I=["template","script","style","meta","link"],D=function(){var p=y.panelStacks.getAll(),E=y.stepLists.getAll();p=p[0].selectedItem;var K=f.querySelector(p.dataset.graniteShellOnboardingStepTarget),S=E[0].selectedItem;if(r){var X=p.querySelector(".granite-shell-onboarding-panel-title");X?r.setAttribute("aria-labelledby",X.id):r.removeAttribute("aria-labelledby");
var M=p.querySelector(".granite-shell-onboarding-panel-desc");M?r.setAttribute("aria-describedby",M.id):r.removeAttribute("aria-describedby");E[0].items.getAll().forEach(function(O){var aa=O.querySelector('[handle\x3d"link"]'),Z=O.querySelector('[handle\x3d"accessibilityLabel"]'),ca=O.querySelector('[handle\x3d"stepMarkerContainer"]');if(O.hasAttribute("labelled")||O.hasAttribute("labelledby"))Z.id=Z.id||O.id+"-accessibilityLabel",ca.id=ca.id||O.id+"-stepMarkerContainer",aa.setAttribute("aria-labelledby",
[Z.id,ca.id].join(" ")),O.removeAttribute("aria-label"),O.removeAttribute("aria-labelledby");aa.removeAttribute("aria-describedby");aa.setAttribute("aria-live","off");aa.setAttribute("aria-atomic","true");aa.setAttribute("aria-relevant","additions");O.hasAttribute("title")&&(aa.setAttribute("title",O.getAttribute("title")),O.removeAttribute("title"));O.hasAttribute("describedby")&&O.removeAttribute("aria-describedby")});S&&(x&&window.clearTimeout(x),e.commons.nextFrame(function(){var O=S.querySelector('[handle\x3d"link"]');
O!==f.activeElement&&r!==f.activeElement?(O.setAttribute("aria-live","off"),M&&O.setAttribute("aria-describedby",M.id),O.focus()):x=window.setTimeout(function(){O.setAttribute("aria-live","assertive");M&&O.setAttribute("aria-describedby",M.id)},20)}))}K?(A?(l.hidden=!1,l.target=K):(E=h(K).outerWidth()-2,H.width(E).removeClass("is-hidden"),setTimeout(function(){H.position({my:"left top",at:"left top",of:K,collision:"none"})},100)),v.position({my:"left top",at:"right+15 top",of:K,collision:"flipfit"})):
(A?l.hidden=!0:H.addClass("is-hidden"),v.position({my:"center",at:"center",of:window,collision:"none"}))},R=function(p){var E=q.dataset.graniteShellOnboardingPrefname;h(window).adaptTo("foundation-preference").set(E,p)},z=function(p){(p||q.querySelector(".granite-shell-onboarding-checkbox").hasAttribute("checked"))&&R(!1);if(q){q.removeAttribute("open");q.off("coral-wizardview:change",D);p=q;for(var E=p.parentNode;p!==f.body&&E;)g(E,p),p=E,E=p.parentNode}l&&H.remove();r&&(r.removeAttribute("aria-describedby"),
r.removeAttribute("aria-labelledby"));L&&L.focus();h(window).off("resize",D);q=l=y=H=r=v=L=null},C=function(p){p.target===q&&z()},F=function(){var p=f.querySelector(".granite-shell-onboarding-src");p&&(p=p.dataset.graniteShellOnboardingSrc)&&h.ajax({url:p,cache:!1}).then(function(E){h(window).adaptTo("foundation-util-htmlparser").parse(E).then(function(K){K=h(K).children();h("body").append(K).trigger("foundation-contentloaded");q=K[0];q.setAttribute("trapFocus","on");q.setAttribute("open","");q.querySelector(".granite-shell-onboarding-panelstack \x3e coral-panel:first-child").setAttribute("selected",
"");y=q.querySelector("coral-wizardview");K=q.querySelector(".granite-shell-onboarding-checkbox");h(K).on("change",function(){R(!this.checked)});r=q.querySelector(".granite-shell-onboarding-popover");v=h(r);A?(l=f.createElement("coral-coachmark"),l.setAttribute("variant","light")):(l=f.createElement("div"),l.className="granite-shell-onboarding-highlight");H=h(l);f.body.appendChild(l);u(q);e.commons.ready(q,function(){h(window).on("resize",D);var S=A?h(q).css("zIndex")+1:h(q).css("zIndex")-1;H.css("zIndex",
S);q.on("coral-wizardview:change",D);q.on("click",".granite-shell-onboarding-done",function(){z(!0)});q.on("click","[coral-close]",function(X){z()});q.on("click",C);q.on("coral-overlay:close",C);D();e.commons.nextFrame(function(){r&&r.focus()})})})})};h(function(){h(window).adaptTo("foundation-preference").getBoolean("granite.shell.showonboarding620",!0)&&F()});h(f).on("click",".granite-shell-onboarding-trigger",function(p){p.preventDefault();F();(p=p.target.closest(".foundation-toggleable"))&&(L=
p.elementToFocusWhenHidden||p.returnFocusToElement)})})(document,Coral,Granite.$);(function(f,e){e(f).on("foundation-mode-change",function(d,b,c){(d=f.querySelector(".granite-shell-header"))&&d.dataset.graniteShellHeaderModeGroup===c&&(d.style.visibility="selection"===b?"hidden":"")});var h=e("#granite-collection-switcher-toggle-button");e(f).ready(function(){"true"===localStorage.getItem("focus-to-view-settings")&&(h.focus(),localStorage.removeItem("focus-to-view-settings"))})})(document,Granite.$);
(function(f,e,h){var d=function(c){var g=f.createElement("div");g.innerHTML=c;return g.textContent};e(f).on("coral-shell-help:search",".granite-shell-help",function(c){var g=this,u=e(this),q=c.originalEvent.detail.value;(c=u.data("granite-shell-help.internal.lastXhr"))&&4!==c.readyState&&c.abort();c=h.expand(g.dataset.graniteShellHelpEndpoint,{q:q});c=e.ajax(c,{dataType:"jsonp",timeout:1E4});u.data("granite-shell-help.internal.lastXhr",c);c.then(function(y){var l=y.results.map(function(r){return{tags:d(r.t0).split(/,\s*/),
title:d(r.title),href:r.href,target:"_blank"}});y=parseInt(y.resultcount.total,10);var H=h.expand(g.dataset.graniteShellHelpSite,{q:q});g.showResults(l,y,H)},function(y,l){g.showError()})});var b=new WeakMap;e(f).on("change",".granite-shortcuts-dialog-enable-switch",function(c){var g=this;c=e(g).closest(".granite-shortcuts-dialog");e(window).adaptTo("foundation-preference").set("shortcutsEnabled",g.checked);c.find(".granite-shortcuts-dialog-enable-alert").prop("hidden",g.checked);b.has(g)||(b.set(g,
!g.checked),c.on("coral-overlay:close",function(){b.get(g)!==g.hasAttribute("checked")&&window.location.reload()}))})})(document,Granite.$,Granite.URITemplate);
(function(f,e){function h(b,c,g){b={element:c.detail&&c.detail._id||"No element defined",type:"tree-item",action:g,widget:{name:"content tree",type:"tree"},feature:"aem:collectionpage",attributes:{}};e(window).adaptTo("foundation-tracker").trackEvent(b)}function d(b,c){var g=b.getAttribute("root-id");if(c.startsWith(g)){c=c.replace(g,"").split("/").filter(function(y){return y});var u=[],q=g;c.forEach(function(y){y=q+"/"+y;u.push({id:y});q=y});0===u.length&&u.push({id:g});b.setAttribute("children",
JSON.stringify(u))}}e(f).on("foundation-toggleable-show",".shell-collectionpage-rail-panel[data-shell-collectionpage-rail-panel\x3d'content-tree']",function(b){b=this.querySelector(".shell-collectionpage-tree");b.classList.contains("is-lazyLoaded")&&(b.classList.remove("is-lazyLoaded"),b.init&&b.init())});e(function(){var b=e(".shell-collectionpage-tree").first(),c=b[0];c&&(e(f).on("change","betty-breadcrumbs.granite-collection-navigator",function(g){if(g=this.selectedItem.dataset.graniteCollectionNavigatorCollectionid){var u=
c.findItemById(g);u?u.selected=!0:c.classList.contains("is-lazyLoaded")&&d(c,g)}}),e(f).on("foundation-collection-reload",".foundation-collection",function(g){var u=c.dataset.shellCollectionpageTreeTarget;e(g.target).is(u)&&(c.classList.contains("is-lazyLoaded")?d(c,g.target.dataset.foundationCollectionId):c.reload(g.target.dataset.foundationCollectionId))}),e(f).on("foundation-selections-change",".foundation-collection",function(g){var u=c.dataset.shellCollectionpageTreeTarget;if(e(g.target).is(u))if(g=
g.target.dataset.foundationCollectionId,c.classList.contains("is-lazyLoaded"))d(c,g);else if(g=c.findItemById(g))b.one("expand",function(q){c._scrollToElement(q.detail)}),g.selectable&&(g.selected=!0)}),b.on("change",function(g){g=g.detail.selectedItem;var u=e(c.dataset.shellCollectionpageTreeTarget),q=u.adaptTo("foundation-collection");q&&g&&g.id!==u[0].dataset.foundationCollectionId&&q.load(g.id)}),b.on("expand",function(g){e(this).is(":visible")&&h(this,g,"expand")}),b.on("collapse",function(g){e(this).is(":visible")&&
h(this,g,"collapse")}))})})(document,Granite.$);
(function(f,e){function h(b){var c=e("#granite-collection-switcher-toggle.granite-collection-switcher");b?d.has(c[0])&&c.append(d.get(c[0])):(b=c.find(".granite-collection-switcher-settings"),b.length&&(b.detach(),d.set(c[0],b[0])))}var d=new WeakMap;e(function(){var b=e(".shell-collectionpage-view").first(),c=b.data("shellCollectionpageViewCookie"),g=b.attr("data-shell-collectionpage-view-target");if(c&&g){var u=b.data("shellCollectionpageViewSettings")||[],q=b.attr("data-shell-collectionpage-view-layoutId");
q=0<=u.indexOf(q);h(q);e(f).on("foundation-layout-perform",function(y){y=e(y.target);if(y.is(g)){y=y.data("foundationLayout");b.attr("data-shell-collectionpage-view-layoutId",y.layoutId);var l=0<=u.indexOf(y.layoutId);h(l);e.cookie(c.name,y.layoutId,c)}})}});e(f).on("foundation-toggleable-beforeshow",function(b){if(e(b.target).is(".shell-collectionpage-viewsettings")){var c=e(".shell-collectionpage-view").first().attr("data-shell-collectionpage-view-layoutId"),g=e("#granite-collection-switcher-toggle-button");
e(".coral_close").click(function(){g.focus()});b.target.querySelector(".shell-collectionpage-viewsettings-tablist").items.getAll().find(function(u){u.getAttribute("data-shell-collectionpage-viewsettings-name")===c&&(u.selected=!0)});e(f).on("keyup",function(u){"Escape"===u.key&&0<e("#shell-collectionpage-viewsettings-form").length&&g.focus()});e(f).click(function(u){u=e(u.target);e(!u.closest("#shell-collectionpage-viewsettings-form").length&&".shell-collectionpage-viewsettings").is(":visible")&&
g.focus()})}})})(document,Granite.$);
(function(f,e,h){e(f).adaptTo("foundation-registry").register("foundation.form.response.ui.success",{name:"granite.view-settings.result",handler:function(d,b,c,g,u){e(".shell-collectionpage-view")&&e(".shell-collectionpage-view").first()&&(d=e(".shell-collectionpage-view").first(),d.data("shellCollectionpageViewCookie")&&d.data("shellCollectionpageViewCookie").name&&(d=d.data("shellCollectionpageViewCookie").name,c=d+"-sortName",e.removeCookie(d,{path:"/"}),e.removeCookie(c,{path:"/"})));e(f).adaptTo("foundation-util-messenger").put(null,
b.message||h.I18n.get("The form has been submitted successfully"),"success");localStorage.setItem("focus-to-view-settings","true");f.location.reload()}})})(window,Granite.$,Granite);